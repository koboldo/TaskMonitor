

<p-panel header="Zlecenia - WO">

  <p-fieldset legend="Wyszukiwanie - WO">
    <form #f="ngForm" (submit)="search()">

      <div class="ui-grid ui-grid-responsive ui-fluid ui-grid-pad">
        <div class="ui-grid-row"  style="margin-top: 20px;">
          <div class="ui-grid-col-1"></div>
          <div class="ui-grid-col-5">
            <label for="lastModAfter">zmodyfikowano od</label>
            <p-calendar name="lastModAfter" [(ngModel)]="lastModAfter" showIcon="true" dateFormat="dd.mm.yy"></p-calendar>
          </div>
          <!--<div class="ui-grid-col-1"></div>-->
          <div class="ui-grid-col-5">
            <label for="lastModBefore">zmodyfikowano do</label>
            <p-calendar name="lastModBefore" [(ngModel)]="lastModBefore"showIcon="true" dateFormat="dd.mm.yy"></p-calendar>
          </div>
          <div class="ui-grid-col-1"></div>
        </div>
        <div class="ui-grid-row"  style="margin-top: 15px;">
          <div class="ui-grid-col-5"></div>
          <div class="ui-grid-col-2">
            <button pButton type="button" (click)="search()" icon="fa-search" label="Szukaj Tena" style="margin-left: 0px; min-width: 80px;" [disabled]="!f?.valid"></button>
          </div>
          <div class="ui-grid-col-5"></div>
        </div>
      </div>

    </form>
  </p-fieldset>


  <div style="margin-top: 5px" *ngIf="orders" class="ui-g">
    <p-dataTable [value]="orders" [rows]="20" [paginator]="true" [globalFilter]="gb" #dt selectionMode="single" [(selection)]="selectedOrder" (onRowSelect)="onRowSelect($event)" dataKey="id" resizableColumns="true" sortField="lastModDate" sortOrder="-1" [loading]="loading" loadingIcon="fa-spinner" [contextMenu]="cm">
      <p-header>
        <div>
          <i class="fa fa-search"></i>
          <input #gb type="text" pInputText size="50" placeholder="Filtruj">
        </div>
      </p-header>
      <p-column [sortable]="true" field="id" header="id" [style]="{'width':'0px'}" ></p-column>
      <p-column [sortable]="true" field="workNo" header="WO" ></p-column>
      <p-column [sortable]="true" field="status" header="Status" ></p-column>
      <p-column [sortable]="true" field="type" header="Typ" ></p-column>
      <p-column [sortable]="true" field="complexity" header="Złożoność" [style]="{'text-align':'center'}">
        <ng-template let-col let-order="rowData" pTemplate="body">
          <button type="button" pButton icon="{{order[col.field]}}"></button>
        </ng-template>
      </p-column>
      <p-column [sortable]="true" field="mdCapex" header="CAPEX" ></p-column>
      <p-column [sortable]="true" field="mdBuildingType" header="Typ budynku" ></p-column>
      <p-column [sortable]="true" field="mdConstructionCategory" header="Konstukcja" ></p-column>
      <p-column [sortable]="true" field="lastModDate" header="Ostatnia modyfikacja"></p-column>

      <p-footer>
        <div class="ui-grid ui-grid-responsive ui-fluid ui-grid-pad">
          <div class="ui-grid-row"  style="margin-top: 15px;">
            <div class="ui-grid-col-1"></div>
            <div class="ui-grid-col-2">
              <button type="button" pButton icon="fa-plus" style="float:left" (click)="add()" label="Dodaj nowe"></button>
            </div>

            <div class="ui-grid-col-6"></div>

            <div class="ui-grid-col-2">
              <button type="button" pButton icon="fa-file-o" iconPos="left" label="CSV" (click)="dt.exportCSV()"></button>
            </div>
            <div class="ui-grid-col-1"></div>
          </div>
        </div>
      </p-footer>

    </p-dataTable>

    <p-contextMenu #cm [model]="items"></p-contextMenu>
  </div>


  <p-dialog header="Zlecenie" [(visible)]="displayEditDialog" [responsive]="true" showEffect="fade" [modal]="true" [minWidth]="300">
    <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="editedOrder">
      <div class="ui-grid-row" style="margin-top: 20px;">
        <div class="ui-grid-col-4"><label for="workNo">Numer WO</label></div>
        <div class="ui-grid-col-8"><input pInputText id="workNo" [(ngModel)]="editedOrder.workNo" /></div>
      </div>
      <div class="ui-grid-row" style="margin-top: 20px;">
        <div class="ui-grid-col-4"><label for="type">Typ WO</label></div>
        <div class="ui-grid-col-8">
            <p-autoComplete id="type" [(ngModel)]="workType" [suggestions]="suggestedTypes" (completeMethod)="suggestType($event)" [dropdown]="true" field="paramChar" forceSelection="true"></p-autoComplete>
        </div>
      </div>
      <div class="ui-grid-row" *ngIf="newOrder == false" style="margin-top: 20px;"><!-- editing status is not allowed for new orders-->
            <div class="ui-grid-col-4"><label for="status">Status</label></div>
            <div class="ui-grid-col-8">
                <p-autoComplete id="status" [(ngModel)]="status" [suggestions]="suggestedStatuses" (completeMethod)="suggestStatus($event)" [dropdown]="true" field="paramChar" forceSelection="true"></p-autoComplete>
            </div>
      </div>
      <div class="ui-grid-row" style="margin-top: 20px;">
        <div class="ui-grid-col-4"><label for="mdCapex">Capex</label></div>
        <div class="ui-grid-col-8"><input pInputText id="mdCapex" [(ngModel)]="editedOrder.mdCapex" /></div>
      </div>
      <div class="ui-grid-row" style="margin-top: 20px;">
        <div class="ui-grid-col-4"><label for="mdBuildingType">Typ budynku</label></div>
        <div class="ui-grid-col-8"><input pInputText id="mdBuildingType" [(ngModel)]="editedOrder.mdBuildingType" /></div>
      </div>
      <div class="ui-grid-row" style="margin-top: 20px;">
        <div class="ui-grid-col-4"><label for="mdConstructionCategory">Konstrukcja</label></div>
        <div class="ui-grid-col-8"><input pInputText id="mdConstructionCategory" [(ngModel)]="editedOrder.mdConstructionCategory" /></div>
      </div>
    </div>
    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix">
        <button type="button" pButton icon="fa-check" (click)="saveOrder()" label="Zapisz"></button>
      </div>
    </p-footer>
  </p-dialog>

  <p-dialog header="Przypisywanie zlecenia" [(visible)]="displayAssignDialog" [responsive]="true" showEffect="fade" [modal]="true" [minWidth]="300">
    <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="editedOrder">
        <div class="ui-grid-row" style="margin-top: 20px;">
            <div class="ui-grid-col-4"><label for="person">Osoba</label></div>
            <!--<div class="ui-grid-col-8"><input pInputText id="person" [(ngModel)]="todo" /></div>-->
            <p-autoComplete id="person" [(ngModel)]="assignedEngineer" [suggestions]="suggestedEngineers" (completeMethod)="suggestEngineer($event)" [dropdown]="true" field="displayName" forceSelection="true"></p-autoComplete>
        </div>
        <div class="ui-grid-row" style="margin-top: 20px;">
            <div class="ui-grid-col-4"><label for="workNo">Numer WO</label></div>
            <div class="ui-grid-col-8"><input pInputText id="workNo" [(ngModel)]="editedOrder.workNo" disabled="true"/></div>
        </div>
        <div class="ui-grid-row" style="margin-top: 20px;">
            <div class="ui-grid-col-4"><label for="type">Typ WO</label></div>
            <div class="ui-grid-col-8"><input pInputText id="type" [(ngModel)]="editedOrder.type" disabled="true"/></div>
        </div>
      <div class="ui-grid-row" style="margin-top: 20px;">
        <div class="ui-grid-col-4"><label for="complexity">Złożoność</label></div>
        <div class="ui-grid-col-8">
          <button type="button" id="complexity" pButton icon="{{editedOrder.complexity}}"></button></div>
      </div>
    </div>
    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix">
        <button type="button" pButton icon="fa-check" (click)="saveAssignment()" label="Przypisz"></button>
      </div>
    </p-footer>
  </p-dialog>


</p-panel>