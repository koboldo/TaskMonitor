

<div style="margin-top: 5px" *ngIf="users" class="ui-g">

  <p-contextMenu #cm [model]="items"></p-contextMenu>

  <p-dataTable [value]="users" [rows]="20" [paginator]="true" [globalFilter]="gb" #dt dataKey="id"
               selectionMode="single"
               sortField="excelId" sortOrder="1"
               [(selection)]="selectedUser"
               (onRowDblclick)="onRowDblclick($event)"
               resizableColumns="true" [loading]="loading" loadingIcon="fa fa-spinner" [contextMenu]="cm" csvSeparator=";" exportFilename="pracownicy">

    <p-header>
      <div>
        <i class="fa fa-search"></i>
        <input #gb type="text" pInputText size="50" placeholder="Filtruj">
        <button [disabled]="operator.roleCode.indexOf('PR') == -1" type="button" pButton icon="fa fa-plus" style="float:left" (click)="add()" label="Dodaj"></button>
      </div>
    </p-header>

    <p-column *ngIf="operator.roleCode.indexOf('PR') >= 0" [style]="{'width':'45px','text-align':'center'}">
      <ng-template let-userRow="rowData" pTemplate="body">
          <button type="button" pButton (click)="showUserHistory($event, userRow)" icon="fa fa-search"></button>
          <p-dialog [(visible)]="displayUserHistoryDialog" [header]="'Historia '+selectedUser?.email" [minWidth]="900" [responsive]="true" [blockScroll]="true" [contentStyle]="{'height': '900px'}">
            <app-user-history [selectedUser]="selectedUser" [staff]="users"></app-user-history>
          </p-dialog>
      </ng-template>
    </p-column>

    <!--<p-column [sortable]="true" field="officeCode" header="Biuro" [filter]="true" filterPlaceholder="Filtruj" [style]="{'text-align':'center', 'width':'20px'}">
    </p-column>-->
    <p-column [sortable]="true" field="office" header="Biuro" [filter]="true" filterPlaceholder="Filtruj" [style]="{'text-align':'center'}">
    </p-column>
    <p-column header="Osoba" field="lastName"  [filter]="true" filterPlaceholder="Nazwisko" [style]="{'text-align':'center'}">
      <ng-template let-col let-user="rowData" pTemplate="body">
        <span [style.font-weight]="'bolder'" class="ui-inputgroup-addon">{{user.firstName}} {{user.lastName}}</span>
      </ng-template>
    </p-column>
    <p-column [sortable]="true" field="isActive" header="Aktywny" [filter]="true" filterPlaceholder="Y/N" filterMatchMode="contains" [style]="{'text-align':'center'}">
      <ng-template let-col let-user="rowData" pTemplate="body">
        <span *ngIf="user[col.field]=='Y'" [style.color]="'green'" class="ui-inputgroup-addon"><i [class]="'fa fa-check'"></i></span>
        <span *ngIf="user[col.field]!='Y'" [style.color]="'grey'"  class="ui-inputgroup-addon"><i [class]="'fa fa-ban'"></i></span>
      </ng-template>
    </p-column>
    <p-column [sortable]="true" field="role" header="Rola" [filter]="true" filterPlaceholder="Filtruj" [style]="{'text-align':'center'}">
      <ng-template let-col let-user="rowData" pTemplate="body">
        <span *ngIf="user.roleCode.indexOf('CN') > -1" [style.color]="'darkblue'" class="ui-inputgroup-addon">{{user.role}}<i [class]="'fa fa-hand-o-down'" [style.margin-left]="'5px'"></i></span>
        <span *ngIf="user.roleCode.indexOf('CN') == -1" [style.color]="'darkviolet'" class="ui-inputgroup-addon">{{user.role}}<i [class]="'fa fa-hand-o-right'" [style.margin-left]="'5px'"></i></span>
      </ng-template>
    </p-column>
   
    <p-column [sortable]="true" field="email" header="Email" [filter]="true" filterPlaceholder="Filtruj" [style]="{'text-align':'center'}"></p-column>
    <p-column [sortable]="true" field="phone" header="Telefon" [filter]="true" filterPlaceholder="Filtruj" [style]="{'text-align':'center'}"></p-column>
    
    <p-footer>
      <div class="ui-grid ui-grid-responsive ui-fluid ui-grid-pad">
        <div class="ui-grid-row"  style="margin-top: 15px;">
          <div class="ui-grid-col-1"></div>
          <div class="ui-grid-col-2">
            <button type="button" pButton icon="fa fa-plus" style="float:left" (click)="add()" label="Dodaj"></button>
          </div>

          <div class="ui-grid-col-6"></div>

          <div class="ui-grid-col-2">
            <button type="button" pButton icon="fa fa-file-o" iconPos="left" label="CSV" (click)="dt.exportCSV()"></button>
          </div>
          <div class="ui-grid-col-1"></div>
        </div>
      </div>
    </p-footer>

    <ng-template pTemplate="emptymessage">
      Brak kontrahentów...
    </ng-template>

  </p-dataTable>
<!-- turbo table  -->

<p-table #tt dataKey="id" [columns]="cols" [value]="users" [rows]="20" [paginator]="true"
  [resizableColumns]="true"   sortField="excelId" sortOrder="1"
  [(selection)]="selectedUser" selectionMode="single"
  loadingIcon="fa fa-spinner" [globalFilterFields]="cols"
  [responsive]="true"
  (dblclick)="onRowDblclick($event)" 
  [metaKeySelection]="false"
  [contextMenu]="cm" [(contextMenuSelection)]="selectedUser"
   csvSeparator=";" exportFilename="pracownicy"
>
<!-- [headerCheckboxToggleAllPages]="false" -->
<ng-template pTemplate="caption">
<div>
  <i class="fa fa-search"></i>
  <input type="text" pInputText size="50" placeholder="Filtruj"
    (input)="tt.filterGlobal($event.target.value, 'contains')" style="width:auto">
</div>
</ng-template>
<ng-template pTemplate="header" let-columns let-rowData>
<tr>
  <th *ngFor="let col of columns" [hidden]="col.hidden" [pSortableColumn]="col.field" [ngClass]="col.class"
    pResizableColumn excludeGlobalFilter = col.exclude>
    <span class="header">
      {{col.header}}
      <p-sortIcon *ngIf="!col.button && col.sortable" [field]="col.field"></p-sortIcon>
    </span>
    
  </th>
  <th header="Historia" [style]="{'width':'26px','text-align':'center'}">
    <ng-template let-userRow="rowData" pTemplate="body">
        <!--<button type="button" pButton (click)="showWoDetails($event, order)" icon="fa fa-search"></button>-->
        
    </ng-template>
  </th>
</tr>
<tr>
  <th *ngFor="let col of columns" [hidden]="col.hidden">
    <input class="width-100" [attr.placeholder]="col.header === 'Pula' ? 'Y/N' : 'Filtruj'" pInputText
      type="text" (input)="tt.filter($event.target.value, col.field, col.filterMatchMode)" *ngIf="col.filter"> 
    
         
  </th>
</tr>
</ng-template>
<ng-template pTemplate="body" let-rowData let-columns="columns" >
<tr [pSelectableRow]="rowData" [pContextMenuRow]="rowData" [pSelectableRowDblClick]="rowData">
  <td *ngFor="let col of columns" [hidden]="col.hidden" filterMatchMode="col.contains" [ngClass]="col.class">

   <span *ngIf="operator.roleCode.indexOf('PR') >= 0 && col.history"  >
    <button type="button"  pButton (click)="showUserHistory($event, rowData)" icon="fa fa-search"></button>
   </span>
   <span *ngIf="col.user">
      <span [style.font-weight]="'bolder'" class="ui-inputgroup-addon">{{rowData.firstName}} {{rowData.lastName}}</span>
   </span>
   <span *ngIf="col.isActive">
    <span *ngIf="rowData[col.field]=='Y'" [style.color]="'green'" class="ui-inputgroup-addon"><i [class]="'fa fa-check'"></i></span>
    <span *ngIf="rowData[col.field]!='Y'" [style.color]="'grey'"  class="ui-inputgroup-addon"><i [class]="'fa fa-ban'"></i></span>
   </span>
   <span *ngIf="col.role">
    <span *ngIf="rowData.roleCode.indexOf('CN') > -1" [style.color]="'darkblue'" class="ui-inputgroup-addon">{{rowData.role}}<i [class]="'fa fa-hand-o-down'" [style.margin-left]="'5px'"></i></span>
    <span *ngIf="rowData.roleCode.indexOf('CN') == -1" [style.color]="'darkviolet'" class="ui-inputgroup-addon">{{rowData.role}}<i [class]="'fa fa-hand-o-right'" [style.margin-left]="'5px'"></i></span>
   </span>
    <span *ngIf="!col.icon">
      {{rowData[col.field]}}
    </span>
    
  </td>
</tr>
</ng-template>
<ng-template pTemplate="footer" let-columns>
  <tr>
      <td *ngFor="let col of columns" [hidden]="col.hidden">
         
        </td>
     
   
  </tr>
</ng-template>
<ng-template pTemplate="summary" let-columns="columns">
  <div class="ui-grid ui-grid-responsive ui-fluid ui-grid-pad">
    <div class="ui-grid-row"  style="margin-top: 15px;">
      <div class="ui-grid-col-1"></div>
      <div class="ui-grid-col-2">
        <button type="button" pButton icon="fa fa-plus" style="float:left" (click)="add()" label="Dodaj"></button>
      </div>

      <div class="ui-grid-col-6"></div>

      <div class="ui-grid-col-2">
        <button type="button" pButton icon="fa fa-file-o" iconPos="left" label="CSV" (click)="dt.exportCSV()"></button>
      </div>
      <div class="ui-grid-col-1"></div>
    </div>
  </div>
</ng-template>
<ng-template pTemplate="emptymessage">
    Brak pracowników...
</ng-template>
</p-table>
<p-contextMenu #cm [model]="items"></p-contextMenu>

<!-- end turbo table  -->

</div>
