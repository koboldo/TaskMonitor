
<p-panel header="Raport utylizacji zespołu">

    <div class="ui-grid-row">
        <div class="ui-grid-col-12">

                <form #f="ngForm" (submit)="search()">

                    <div class="ui-grid ui-grid-responsive ui-fluid ui-grid-pad">
                        <div class="ui-grid-row"  style="margin-top: 20px;">
                            <div class="ui-grid-col-1"></div>
                            <div class="ui-grid-col-5">
                                <label for="afterDate">od</label>
                                <p-calendar name="afterDate" [locale]="pl" [(ngModel)]="afterDate" showIcon="true" dateFormat="dd.mm.yy" utc="true"></p-calendar>
                            </div>
                            <!--<div class="ui-grid-col-1"></div>-->
                            <div class="ui-grid-col-5">
                                <label for="beforeDate">do</label>
                                <p-calendar name="beforeDate" [locale]="pl" [(ngModel)]="beforeDate" showIcon="true" dateFormat="dd.mm.yy" utc="true"></p-calendar>
                            </div>
                            <div class="ui-grid-col-1"></div>
                        </div>
                        <div class="ui-grid-row"  style="margin-top: 15px;">
                            <div class="ui-grid-col-5"></div>
                            <div class="ui-grid-col-2">
                                <button pButton type="button" (click)="search()" icon="fa-search" label="Szukaj Laros" style="margin-left: 0px; min-width: 140px; max-width: 200px;" [disabled]="!f?.valid"></button>
                            </div>
                            <div class="ui-grid-col-5"></div>
                        </div>
                    </div>

                </form>
        </div>
    </div>
</p-panel>



<div *ngIf="chartsReady">
    <div class="ui-grid-row">
        <div class="ui-grid-col-12">
            <p-panel header="Wydajność">
                <p-chart type="bar" [data]="chartUtilizationData" ></p-chart>
            </p-panel>
        </div>
    </div>
    <div class="ui-grid-row">
        <div class="ui-grid-col-6">
            <p-panel header="Zakładany czas w godzinach obliczony na podstawie pracochłonności wykonanych WO">
                <p-chart type="polarArea" [data]="chartShareData"></p-chart>
            </p-panel>
        </div>
        <div class="ui-grid-col-6">
            <p-panel header="Wypracowany budżet w PLN">
                <p-chart type="bar" [data]="chartEarnedData"></p-chart>
            </p-panel>
        </div>
    </div>
</div>

<div style="margin-top: 5px" *ngIf="reports" class="ui-g">
    <p-dataTable [value]="reports" [rows]="20" [paginator]="true" [globalFilter]="gb" #dt selectionMode="single" [(selection)]="selectedReport" (onRowSelect)="onRowSelect($event)" dataKey="id" resizableColumns="true" sortField="timeUtilizationPercentage" sortOrder="-1" [loading]="loading" loadingIcon="fa-spinner">
        <p-header>
            <div>
                <i class="fa fa-search"></i>
                <input #gb type="text" pInputText size="50" placeholder="Filtruj">
            </div>
        </p-header>
        <p-column [sortable]="true" field="id" header="id" hidden="true" ></p-column>

        <p-column [sortable]="true" field="timeUtilizationPercentage" header="Ocena" [style]="{'text-align':'center', 'width':'60px'}">
            <ng-template let-col let-report="rowData" pTemplate="body">
                <span class="ui-inputgroup-addon" [style.color]="report.iconColor"><i [class]="report.icon"></i></span>
            </ng-template>
        </p-column>
        <p-column [sortable]="true" field="timeUtilizationPercentage" header="Wydajność" [style]="{'text-align':'right'}">
            <ng-template let-col let-userData="rowData" pTemplate="body">
                <span *ngIf="userData?.timeUtilizationPercentage >= 0" style="padding: 3px">{{userData.timeUtilizationPercentage}}%</span>
                <span *ngIf="userData?.timeUtilizationPercentage === noTimesheets" style="padding: 3px">Brak deklaracji czasu pracy</span>
                <span *ngIf="userData?.timeUtilizationPercentage === holidays" style="padding: 3px">Urlop</span>
            </ng-template>
        </p-column>


        <p-column [sortable]="true" field="firstName" header="Imie" ></p-column>
        <p-column [sortable]="true" field="lastName" header="Nazwisko" ></p-column>
        <p-column [sortable]="true" field="role" header="Rola" [style]="{'text-align':'center'}"></p-column>
        <p-column [sortable]="true" field="office" header="Biuro" [style]="{'text-align':'center'}"></p-column>
        <p-column [sortable]="true" field="isFromPool" header="Pula" [filter]="true" filterPlaceholder="Y/N" [style]="{'text-align':'center', 'width':'55px'}">
            <ng-template let-col let-user="rowData" pTemplate="body">
                <span *ngIf="user[col.field]=='Y'" [style.color]="'green'" class="ui-inputgroup-addon"><i [class]="'fa fa-users'"></i></span>
                <span *ngIf="user[col.field]!='Y'" [style.color]="'grey'" class="ui-inputgroup-addon"><i [class]="'fa fa-street-view'"></i></span>
            </ng-template>
        </p-column>

        <p-column [sortable]="true" field="declaredTime" header="Czas zadeklarowany"  [style]="{'text-align':'right'}">
            <ng-template let-col let-report="rowData" pTemplate="body">
                <span>{{report[col.field] | number: '1.2-2'}} godz.</span>
            </ng-template>
        </p-column>
        <p-column [sortable]="true" field="expectedTime" header="Czas zakładany" [style]="{'text-align':'right'}">
            <ng-template let-col let-report="rowData" pTemplate="body">
                <span>{{report[col.field] | number: '1.2-2'}} godz.</span>
            </ng-template>
        </p-column>
        <p-column [sortable]="true" field="noOrdersDone" header="Ukończonych WO" [style]="{'text-align':'right'}"></p-column>
        <p-column [sortable]="true" field="earnedMoney" header="Wypracowany budżet" [style]="{'text-align':'right'}">
            <ng-template let-col let-report="rowData" pTemplate="body">
                <span>{{report[col.field] | currency: 'PLN'}}</span>
            </ng-template>
        </p-column>



        <ng-template pTemplate="emptymessage">
            Brak raportów w zakresie dat...
        </ng-template>

        <p-footer>
        </p-footer>

    </p-dataTable>

</div>


<!-- defaultDate="2017-11-01" -->

<p-dialog *ngIf="selectedReport" [header]="selectedReport?.firstName +' '+selectedReport?.lastName +' ('+selectedReport?.timeUtilizationPercentage+'%)'" [(visible)]="schedulerDisplay" [responsive]="true" showEffect="fade" [modal]="true" [minWidth]="800" [width]="800">
    <div class="ui-grid ui-grid-responsive ui-fluid">
        <p-schedule [events]="schedulerEvents" [header]="schedulerHeader" [eventLimit]="8" [editable]="false" (onEventClick)="handleOrderClick($event)" [locale]="'pl'"></p-schedule>
    </div>
</p-dialog>

<p-dialog [header]="selectedOrder?.workNo + (selectedOrder?.doneDate? ' wykonano': ' w realizacji...' )" [(visible)]="orderDialogDisplay" [responsive]="true" showEffect="fade" [modal]="true" [minWidth]="800" [width]="900" [blockScroll]="true" [contentStyle]="{'height': '800px'}">

    <div *ngIf="selectedOrder?.workNo">
        <div class="ui-grid-row">
            <div class="ui-grid-col-12">
                <p-fieldset legend="Realizacja" *ngIf="selectedOrder">
                    <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="selectedOrder">

                        <div class="ui-grid-row" style="margin-top: 10px;">
                            <div class="ui-grid-col-4">Przypisano</div>
                            <div class="ui-grid-col-8">{{selectedOrder.assignedDate}}</div>
                        </div>

                        <div class="ui-grid-row" style="margin-top: 10px;" *ngIf="selectedOrder?.doneDate">
                            <div class="ui-grid-col-4">Wykonano</div>
                            <div class="ui-grid-col-8">{{selectedOrder.doneDate}}</div>
                        </div>

                    </div>

                </p-fieldset>
            </div>
        </div>

        <div class="ui-grid-row">
            <div class="ui-grid-col-12">
                <app-wo-details [selectedOrder]="selectedOrder"></app-wo-details>
            </div>
        </div>
    </div>


</p-dialog>


