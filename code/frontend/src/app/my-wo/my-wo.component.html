<p-panel header="Moje oczekujące zlecenia">


  <div style="margin-top: 5px" *ngIf="orders" class="ui-g">
    <p-dataTable [value]="orders" [rows]="20" [paginator]="true" [globalFilter]="gb" #dt selectionMode="single" [(selection)]="selectedOrder" (onRowSelect)="onRowSelect($event)" dataKey="id" resizableColumns="true" sortField="lastModDate" sortOrder="-1" [loading]="loading" loadingIcon="fa-spinner" [contextMenu]="cm">
      <p-header>
        <div>
          <i class="fa fa-search"></i>
          <input #gb type="text" pInputText size="50" placeholder="Filtruj">
          <button type="button" pButton icon="fa-refresh" style="float:left" (click)="search()" label="Odśwież"></button>
        </div>
      </p-header>
      <p-column [sortable]="true" field="workNo" header="WO" ></p-column>

      <p-column [sortable]="true" field="status" header="statusSearch"  [style]="{'width':'0px'}"></p-column><!-- search -->
      <p-column [sortable]="true" field="statusCode" header="Status" >
        <ng-template let-col let-order="rowData" pTemplate="body">
          <span class="ui-inputgroup-addon"><i [class]="toolsService.getStatusIcon(order.statusCode)"></i></span>
          <span style="padding: 3px">{{order.status}}</span>
        </ng-template>
      </p-column>

      <p-column [sortable]="true" field="type" header="typeSearch"  [style]="{'width':'0px'}"></p-column><!-- search -->
      <p-column [sortable]="true" field="typeCode" header="Typ">
        <ng-template let-col let-order="rowData" pTemplate="body">
          <span [style.color]="toolsService.getOrderColor(order.typeCode)" class="ui-inputgroup-addon"><i [class]="'fa fa-square'"></i></span>
          <span style="padding: 3px">{{order.type}}</span>
        </ng-template>
      </p-column>

      <p-column [sortable]="true" field="complexityCode" header="Złożoność" [style]="{'text-align':'center'}">
        <ng-template let-col let-order="rowData" pTemplate="body">
          <span class="ui-inputgroup-addon"><i [class]="order[col.field]=='STD' ? 'fa fa-thumbs-o-up': 'fa fa-life-bouy'"></i></span>
        </ng-template>
      </p-column>
      <p-column [sortable]="true" field="mdCapex" header="CAPEX" ></p-column>
      <p-column [sortable]="true" field="price" header="Wartość" styleClass="text-right"></p-column>

      <p-column [sortable]="true" field="comment" header="Komentarz" hiddem="true"></p-column>
      <p-column [sortable]="true" field="description" header="Opis" hiddem="true"></p-column>
      <p-column [sortable]="true" field="lastModDate" header="Modyfikacja"></p-column>
      <p-column [sortable]="true" field="creationDate" header="Dodano"></p-column>

      <!-- search by invisible colums, display in one row -->
      <p-column [sortable]="true" field="itemNo" header="Numer obiektu" ></p-column>
      <!-- search by invisible colums flatten into order by wo.service -->
      <p-column [sortable]="true" field="itemBuildingType" header="Typ obiektu"   hidden="true"></p-column>
      <p-column [sortable]="true" field="itemConstructionCategory" header="Konstukcja"   hidden="true"></p-column>
      <p-column [sortable]="true" field="itemAddress" header="Adres"  hidden="true"></p-column>
      <p-column [sortable]="true" field="itemDescription" header="Opis obiektu"  hidden="true"></p-column>

        <p-column [style]="{'width':'40px','text-align':'center'}">
            <ng-template let-order="rowData" pTemplate="body">
                <button type="button" pButton (click)="selectedOrder=order; onRowSelect($event); displayDetailsDialog=true" icon="fa-search"></button>
            </ng-template>
        </p-column>

      <ng-template pTemplate="emptymessage">
        Brak zleceń do bieżącej obsługi, poproś o więcej lub idź do domu...
      </ng-template>

      <p-footer></p-footer>

    </p-dataTable>

    <p-contextMenu #cm [model]="items"></p-contextMenu>
  </div>

    <p-dialog [(visible)]="displayDetailsDialog" [header]="'Zamowienie '+selectedOrder?.workNo" [minWidth]="600" [responsive]="true" showEffect="fade" [modal]="true" [blockScroll]="true" [contentStyle]="{'height': '800px'}">
        <app-wo-details [selectedOrder]="selectedOrder"></app-wo-details>
    </p-dialog>

  <p-dialog header="Potwierdzenie wykonania zlecenia" [(visible)]="displayFinishDialog" [responsive]="true" showEffect="fade" [modal]="true" [minWidth]="500">
    <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="editedOrder">
      <div class="ui-grid-row" style="margin-top: 10px;">
        <div class="ui-grid-col-4"><label for="workNo">Numer WO</label></div>
        <div class="ui-grid-col-8 ui-fluid"><input pInputText id="workNo" [(ngModel)]="editedOrder.workNo" width="auto" disabled="true"/></div>
      </div>
      <div class="ui-grid-row" style="margin-top: 10px;">
        <div class="ui-grid-col-4"><label for="type">Typ WO</label></div>
        <div class="ui-grid-col-8">
          <input pInputText id="type" [(ngModel)]="editedOrder.type" disabled="true"/>
        </div>
      </div>
      <div class="ui-grid-row" style="margin-top: 10px;"><!-- editing status is not allowed -->
        <div class="ui-grid-col-4"><label for="status">Status</label></div>
        <div class="ui-grid-col-8">
          <input pInputText id="status" [(ngModel)]="editedOrder.status" disabled="true"/>
        </div>
      </div>
    </div>
    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix">
        <button width="200px" type="button" pButton icon="fa-check" (click)="saveOrder()" label="Zakończ"></button>
      </div>
    </p-footer>
  </p-dialog>


</p-panel>