

<p-panel header="Deklaracje czasu pracy">

  <div class="ui-grid-row">
    <div class="ui-grid-col-8">
      <p-fieldset legend="Listy obecności">
        <form #f="ngForm" (submit)="search()">

          <div class="ui-grid ui-grid-responsive ui-fluid ui-grid-pad">
            <div class="ui-grid-row"  style="margin-top: 20px;">
              <div class="ui-grid-col-1"><label style="float: right" for="afterDate">Od</label></div>
              <div class="ui-grid-col-3">
                <!--<p-calendar id="date" name="reportDate" (onSelect)="search()" [(ngModel)]="reportDate" showIcon="true" dateFormat="dd.mm.yy" utc="true"></p-calendar>-->
                <p-calendar id="afterDate" name="afterDate" [(ngModel)]="afterDate" showIcon="true" dateFormat="dd.mm.yy" utc="true"></p-calendar>
              </div>
              <div class="ui-grid-col-1"><label style="float: right" for="beforeDate">Do</label></div>
              <div class="ui-grid-col-3">
                <!--<p-calendar id="date" name="reportDate" (onSelect)="search()" [(ngModel)]="reportDate" showIcon="true" dateFormat="dd.mm.yy" utc="true"></p-calendar>-->
                <p-calendar id="beforeDate" name="beforeDate" [(ngModel)]="beforeDate" showIcon="true" dateFormat="dd.mm.yy" utc="true"></p-calendar>
              </div>
              <div class="ui-grid-col-4">
                <button pButton type="button" (click)="search()" icon="fa-search" label="Szukaj" style="margin-left: 0px; min-width: 140px; max-width: 200px;" [disabled]="!f?.valid"></button>
              </div>
            </div>
          </div>

        </form>
      </p-fieldset>
    </div>
  </div>

  <div class="ui-grid-row" *ngIf="engineersWithSheets">
    <p-dataTable [editable]="true" (onEditInit)="onEditInit($event)" (onEditCancel)="onEditCancel($event)" (onEditComplete)="onEditComplete($event)" [value]="engineersWithSheets" [rows]="20" [paginator]="true" [globalFilter]="gb" #dt dataKey="tabid" resizableColumns="true" sortField="lastName" sortOrder="1" [loading]="loading" loadingIcon="fa-spinner">
      <p-header>
        <div>
          <i class="fa fa-search"></i>
          <input #gb type="text" pInputText size="50" placeholder="Filtruj">
        </div>
      </p-header>

      <p-column [sortable]="true" field="tabid" header="tabid" hidden="true" ></p-column>
      <p-column [sortable]="true" field="office" header="Biuro"></p-column>
      <p-column [sortable]="true" field="role" header="Rola"></p-column>
      <p-column [sortable]="true" field="email" header="Email" ></p-column>
      <p-column [sortable]="true" field="firstName" header="Imie" ></p-column>
      <p-column [sortable]="true" field="lastName" header="Nazwisko" ></p-column>



      <p-column [sortable]="true" field="timesheetWorkDate" header="Dnia">
        <ng-template let-col let-timesheet="rowData" pTemplate="body">
          <div [style.color]="timesheet.color" class="text-center">{{timesheet.timesheetWorkDate}}</div>
        </ng-template>
      </p-column>

      <p-column [editable]="user?.roleCode === 'PR' || user?.roleCode === 'OP'" [sortable]="true" header="Obecny od" field="timesheetFrom">
        <ng-template let-col let-timesheet="rowData" pTemplate="body">
          <div [style.color]="timesheet.color" class="text-center">{{timesheet.timesheetFrom}}</div>
        </ng-template>
      </p-column>

      <p-column [editable]="user?.roleCode === 'PR' || user?.roleCode === 'OP'" [sortable]="true" header="Obecny do" field="timesheetTo">
        <ng-template let-col let-timesheet="rowData" pTemplate="body">
          <div [style.color]="timesheet.color" class="text-center">{{timesheet.timesheetTo}}</div>
        </ng-template>
      </p-column>

      <p-column [editable]="user?.roleCode === 'PR' || user?.roleCode === 'OP'" [sortable]="true" header="Przerwa [min]" field="timesheetBreakInMinutes">
        <ng-template let-col let-timesheet="rowData" pTemplate="body">
          <div [style.color]="timesheet.color" class="text-center">{{timesheet.timesheetBreakInMinutes}}</div>
        </ng-template>
      </p-column>

      <p-column [sortable]="true" field="timesheetWorkDate" header="Godziny">
        <ng-template let-col let-timesheet="rowData" pTemplate="body">
          <div [style.color]="timesheet.color" class="text-center">{{timesheet.timesheetUsedTime}}</div>
        </ng-template>
      </p-column>

      <!--
      <p-column [sortable]="true" field="timesheetWohrkDate" header="Dnia" [style]="{'color':'darkred', 'text-align':'center'}"></p-column>
      <p-column [editable]="user?.roleCode === 'PR' || user?.roleCode === 'OP'" [sortable]="true" field="timesheetFrom" header="Obecny od" [style]="{'color':'darkred', 'text-align':'center'}"></p-column>
      <p-column [editable]="user?.roleCode === 'PR' || user?.roleCode === 'OP'" [sortable]="true" field="timesheetTo" header="Obecny do" [style]="{'color':'darkred', 'text-align':'center'}"></p-column>
      <p-column [editable]="user?.roleCode === 'PR' || user?.roleCode === 'OP'" [sortable]="true" field="timesheetBreakInMinutes" header="Przerwa [min]" [style]="{'color':'darkred', 'text-align':'center'}"></p-column>
      <p-column [sortable]="true" field="timesheetUsedTime" header="Godziny" [style]="{'color':'darkred', 'text-align':'center'}"></p-column>
      -->


      <ng-template pTemplate="emptymessage">
        Brak danych...
      </ng-template>

      <p-footer>
        <div class="ui-grid ui-grid-responsive ui-fluid ui-grid-pad">
          <div  *ngIf="user?.roleCode === 'PR' || user?.roleCode === 'OP'" class="ui-grid-row"  style="margin-top: 15px;">
            <div class="ui-grid-col-5"></div>
            <div class="ui-grid-col-2">
              <!--<button type="button" pButton icon="fa-file-o" iconPos="left" label="CSV" (click)="dt.exportCSV()"></button>-->
              <button type="button" pButton icon="fa-check" iconPos="left" label="Zapisz" (click)="showConfirmDialog()"></button>
            </div>
            <div class="ui-grid-col-5"></div>
          </div>
        </div>
      </p-footer>

    </p-dataTable>
  </div>


  <p-dialog header="Modyfikacja zadeklarowanego czasu pracy" [(visible)]="displayConfirmationDialog" [responsive]="true" showEffect="fade" [modal]="true" [minWidth]="500">

    <div class="ui-grid ui-grid-responsive ui-fluid">

      <div *ngFor="let warn of warns" class="ui-grid-row" style="margin-top: 10px;">
        <div class="ui-grid-col-12">
          <p-message severity="warn" [text]="warn"></p-message>
        </div>
      </div>

      <div class="ui-grid-row" style="margin-top: 10px;">
        <div class="ui-grid-col-12" *ngIf="!(engineerWithChangedSheet?.length > 0)"><label>Brak zmian!</label></div>
        <div class="ui-grid-col-12" *ngIf="engineerWithChangedSheet?.length > 0">
          <div *ngFor="let e of engineerWithChangedSheet">
            <span style="margin-bottom: 10px"><strong>{{e.firstName}} {{e.lastName}}</strong> w dniu {{e.timesheetWorkDate}} przepracował <strong>{{e.timesheetUsedTime}}</strong> godzin.</span>
            <br>
          </div>
        </div>
      </div>

    </div>
    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix">
        <button width="200px" type="button" [disabled]="!(engineerWithChangedSheet?.length > 0)" pButton icon="fa-check" (click)="saveSheets()" label="Zapisz"></button>
      </div>
    </p-footer>
  </p-dialog>




</p-panel>
